webpackJsonp([1],{"+c27":function(e,t){},"7Oqs":function(e,t){},"8/xU":function(e,t){},"97dx":function(e,t){},"9Fhu":function(e,t){},Hjdr:function(e,t){},JKiR:function(e,t){},LbV3:function(e,t){},NAlg:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n("MY4N");var a=n("0zAV"),r=(n("cZ0s"),n("fIxc")),o=(n("OWWB"),n("1fWZ")),i=(n("RIEG"),n("zjGD")),s=(n("3Lne"),n("SSsa")),c=(n("i0mo"),n("Hkar")),l=(n("LlGJ"),n("Wtz3")),u=(n("eqfM"),n("/QYm")),m=(n("RgoE"),n("0KWt")),f=(n("1E9F"),n("2Ux5")),v=(n("NjV0"),n("dq/I")),d=(n("1O2T"),n("sXqm")),p=(n("XmAh"),n("il3B")),h=(n("FO5P"),n("woHG")),g=n("7+uW"),_={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var b=n("VU/8")({name:"App"},_,!1,function(e){n("ia5V")},null,null).exports,k=n("/ocq"),w={data:function(){return{userName:"",password:"",remember:!1}},methods:{login:function(){this.common.login(this.userName,this.password,this.remember,"/")}},created:function(){var e=this.common.getCookie("userName"),t=Base64.decode(this.common.getCookie("password")),n=this.common.getCookie("remember");this.userName=e||"",this.password=t||"",this.remember="true"===n}},y={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",[e._m(0),e._v(" "),n("van-cell-group",{staticClass:"login",attrs:{border:!1}},[n("van-field",{attrs:{required:"",clearable:"",label:"用户名",placeholder:"请输入用户名"},model:{value:e.userName,callback:function(t){e.userName=t},expression:"userName"}}),e._v(" "),n("van-field",{attrs:{type:"password",label:"密码",placeholder:"请输入密码",required:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),n("van-checkbox",{model:{value:e.remember,callback:function(t){e.remember=t},expression:"remember"}},[e._v("记住密码")]),e._v(" "),n("div",{staticClass:"btn"},[n("van-button",{attrs:{type:"primary"},on:{click:e.login}},[e._v("登 录")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"header"},[t("img",{attrs:{src:n("yRcn")}})])}]};var N=n("VU/8")(w,y,!1,function(e){n("R8Mq")},null,null).exports,L=n("NYxO");g.a.use(L.a);var x,R,O=new L.a.Store({state:{headerName:"",deviceList:[]},mutations:{initList:function(e,t){e.deviceList=t.deviceDataJson},setHeaderName:function(e,t){e.headerName=t}}}),A=0;var $={data:function(){return{active:0}},computed:{name:function(){return this.$store.state.headerName}},created:function(){!function e(t){(R=new WebSocket("ws://www.lovdmx.com:10001/lovdmx_control/websocket/socketServer")).onopen=function(){A=0,clearTimeout(x),console.log("连接成功")},R.onmessage=function(e){switch(JSON.parse(e.data).opCode){case 2222:t.$store.commit("initList",JSON.parse(e.data))}},R.onerror=function(){A++,R.close(),A>5?alert("与服务器连接失败！"):x=setTimeout(function(){e()},1e3)},R.onclose=function(){console.log("websocket断开连接了")}}(this)}},q={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"wrap"},[n("van-nav-bar",{staticClass:"header",attrs:{title:e.name,fixed:"",border:!1}}),e._v(" "),n("div",{staticClass:"block"}),e._v(" "),n("router-view"),e._v(" "),n("div",{staticClass:"block"}),e._v(" "),n("van-tabbar",{attrs:{route:""},model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[n("van-tabbar-item",{attrs:{icon:"home-o",replace:"",to:"/"}},[e._v("首页")]),e._v(" "),n("van-tabbar-item",{attrs:{icon:"cluster-o",replace:"",to:"/node"}},[e._v("节点")]),e._v(" "),n("van-tabbar-item",{attrs:{icon:"location-o",replace:"",to:"/map"}},[e._v("地图")]),e._v(" "),n("van-tabbar-item",{attrs:{icon:"setting-o",replace:"",to:"/system"}},[e._v("系统")])],1)],1)},staticRenderFns:[]};var C=n("VU/8")($,q,!1,function(e){n("ci8q")},null,null).exports,M={render:function(){var e=this.$createElement;return(this._self._c||e)("div")},staticRenderFns:[]};var E=n("VU/8")({data:function(){return{}},created:function(){var e=this.$router.currentRoute.name;this.$store.commit("setHeaderName",e)}},M,!1,function(e){n("7Oqs")},null,null).exports,F=n("//Fk"),H=n.n(F),I=n("mtWM"),T=n.n(I);T.a.defaults.baseURL="http://www.lovdmx.com:10001/lovdmx_control/",T.a.defaults.withCredentials=!0,T.a.interceptors.response.use(function(e){if("false"!==e.data.result)return e.data;Q.push({path:"/login"})},function(e){return Q.push({path:"/404"}),H.a.resolve(e.response)});var V={data:function(){return{gatewayList:[]}},methods:{getGatewayList:function(){var e,t=this;T.a.get("webControlServer/getIntelligentGatewayInfo",{params:e}).then(function(e){if("true"===e.result){console.log(e);for(var n=[],a=0;a<e.intelligentGatewayList.length;a++)n[a]=e.intelligentGatewayList[a],n[a].mode=1===n[a].isOnline?"在线":"离线";t.gatewayList=n}})}},created:function(){var e=this.$router.currentRoute.name;this.$store.commit("setHeaderName",e),this.getGatewayList()}},P={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("van-cell-group",e._l(e.gatewayList,function(t){return n("van-cell",{attrs:{title:t.rackName,value:t.mode},on:{click:function(n){return e.$router.push({path:"/relay",query:{mac:t.mac,rackId:t.rackId,isOnline:t.isOnline,rackName:t.rackName}})}}})}),1)},staticRenderFns:[]};var B=n("VU/8")(V,P,!1,function(e){n("dtE/")},null,null).exports,U={data:function(){return{name:"",isOnline:"",relayList:[],activeNames:[]}},methods:{getRelayList:function(e){var t,n=this;(t={gatewayMac:e},T.a.get("webControlServer/getRelayInfoByGatewayMac",{params:t})).then(function(e){if("true"===e.result){for(var t=0;t<e.relayList.length;t++){var a=G(e.relayList[t].electricRelayLoopON,e.relayList[t].electricRelayLoopOFF);e.relayList[t].loopList=a}n.relayList=e.relayList}})}},created:function(){var e=this.$router.currentRoute.query;this.name=e.rackName,this.getRelayList(e.mac),this.isOnline=1===e.isOnline?"在线":"离线"}};function G(e,t){for(var n=e.split(","),a=t.split(","),r=[],o=0;o<n.length;o++)n[o]&&(r[parseInt(n[o])]=!0);for(o=0;o<a.length;o++)a[o]&&(r[parseInt(a[o])]=!1);return r}var S={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",[n("van-nav-bar",{staticClass:"header",class:{online:"在线"===e.isOnline,offline:"离线"===e.isOnline},attrs:{title:e.name,"left-text":"返回","right-text":e.isOnline,"left-arrow":"",fixed:"",border:!1},on:{"click-left":function(t){return e.$router.go(-1)}}}),e._v(" "),n("div",{staticClass:"block"}),e._v(" "),n("van-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.relayList,function(t,a){return n("van-collapse-item",{attrs:{title:t.rs485toNetIp+"-"+t.slaveAddr,name:a+1}},[n("van-cell-group",{attrs:{border:!1}},e._l(t.loopList,function(e,t){return n("van-cell",{attrs:{title:t+1,value:e?"打开":"关闭"}})}),1)],1)}),1)],1)},staticRenderFns:[]};var W=n("VU/8")(U,S,!1,function(e){n("ZTsi")},null,null).exports,z={render:function(){var e=this.$createElement,t=this._self._c||e;return t("baidu-map",{staticClass:"baidu-map",attrs:{center:this.center,zoom:this.zoom,"map-type":"BMAP_NORMAL_MAP","scroll-wheel-zoom":"","map-click":!1},on:{ready:this.handler}},[t("bm-map-type",{attrs:{"map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),this._v(" "),this._l(this.markers,function(e){return t("bm-marker",{attrs:{position:{lng:e.rackLongitude,lat:e.rackLatitude}}})}),this._v(" "),t("bm-city-list",{attrs:{anchor:"BMAP_ANCHOR_TOP_LEFT"}})],2)},staticRenderFns:[]};var j={data:function(){return{}},components:{vueMap:n("VU/8")({data:function(){return{center:{lng:0,lat:0},zoom:3}},computed:{markers:function(){return this.$store.state.deviceList.sonRackDeviceList}},methods:{handler:function(e){e.BMap,e.map,this.center.lng=103.8127504728,this.center.lat=36.0650310424,this.zoom=18}},created:function(){}},z,!1,function(e){n("Hjdr")},null,null).exports},created:function(){var e=this.$router.currentRoute.name;this.$store.commit("setHeaderName",e)}},D={render:function(){var e=this.$createElement,t=this._self._c||e;return t("section",{staticClass:"map"},[t("vueMap")],1)},staticRenderFns:[]};var J=n("VU/8")(j,D,!1,function(e){n("LbV3")},null,null).exports,Z={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",[n("van-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[n("van-collapse-item",{attrs:{title:"用户信息",name:"1"}},[e._v("内容")]),e._v(" "),n("van-collapse-item",{attrs:{title:"当前版本",name:"2"}},[e._v("内容")]),e._v(" "),n("van-collapse-item",{attrs:{title:"用户指南",name:"3"}},[e._v("内容")]),e._v(" "),n("van-collapse-item",{attrs:{title:"关于",name:"4"}},[e._v("内容")])],1),e._v(" "),n("div",{staticClass:"btn"},[n("van-button",{attrs:{type:"danger"},on:{click:e.logout}},[e._v("退出登录")])],1)],1)},staticRenderFns:[]};var K=n("VU/8")({data:function(){return{activeNames:[]}},methods:{logout:function(){var e=this;this.$dialog.confirm({title:"提示",message:"确认退出当前账号"}).then(function(){e.common.logout()}).catch(function(){})}},created:function(){var e=this.$router.currentRoute.name;this.$store.commit("setHeaderName",e)}},Z,!1,function(e){n("8/xU")},null,null).exports;g.a.use(k.a);var Y=new k.a({routes:[{path:"/login",name:"登录",component:N},{path:"/",component:C,children:[{path:"/",name:"首页",component:E,meta:{requireAuth:!0}}]},{path:"/",component:C,children:[{path:"/node",name:"节点",component:B,meta:{requireAuth:!0}}]},{path:"/relay",name:"继电器",component:W,meta:{requireAuth:!0}},{path:"/",component:C,children:[{path:"/map",name:"地图",component:J,meta:{requireAuth:!0}}]},{path:"/",component:C,children:[{path:"/system",name:"系统",component:K,meta:{requireAuth:!0}}]}]}),Q=Y;Y.beforeEach(function(e,t,n){e.meta.requireAuth?sessionStorage.getItem("token")?n():n({path:"/login",query:{redirect:e.fullPath}}):n()});var X=n("dAEq"),ee=n.n(X),te=n("mvHQ"),ne=n.n(te);g.a.use(u.a);var ae=n("xrTZ").Base64,re=function(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){var r=n[a].trim();if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""},oe=function(e,t,n){var a=new Date;a.setTime(a.getTime()+1e3*n);var r="expires="+a.toGMTString();document.cookie=e+"="+t+"; "+r},ie={login:function(e,t,n,a){(function(e){return T.a.post("login",e)})({userName:e,password:t,remember:n}).then(function(r){switch(console.log(r),r.flag){case"0":sessionStorage.setItem("token",ne()(r.account)),Q.push({path:a}),function(e,t,n){oe("userName",e,31536e3);var t=ae.encode(t);oe("password",t,31536e3),oe("remember",n,31536e3)}(e,t,n);break;case"1":break;case"2":u.a.fail("账号不存在");break;case"3":u.a.fail("密码错误");break;case"4":u.a.fail("账号已被禁用");break;case"5":u.a.fail("账号已在线");break;default:u.a.fail("未知错误")}})},logout:function(){T.a.get("remove").then(function(e){e&&("false"===re("remember")&&(oe("userName","",null),oe("password","",null)),Q.push("/login"))})},getCookie:re,setCookie:oe};g.a.use(a.a).use(r.a).use(o.a).use(i.a).use(s.a).use(c.a).use(l.a).use(u.a).use(m.a).use(f.a).use(v.a).use(d.a).use(p.a).use(h.a),g.a.use(ee.a,{ak:"Kbnu8vBKPYnDk1tnMKju1y3nb6QqDeT7"}),g.a.prototype.common=ie,g.a.config.productionTip=!1,new g.a({el:"#app",router:Q,store:O,components:{App:b},template:"<App/>"})},R8Mq:function(e,t){},ZTsi:function(e,t){},ci8q:function(e,t){},"dtE/":function(e,t){},eh36:function(e,t){},hW8u:function(e,t){},ia5V:function(e,t){},nLpc:function(e,t){},nOtf:function(e,t){},nsZj:function(e,t){},px3J:function(e,t){},yRcn:function(e,t,n){e.exports=n.p+"lovdmx_control/static1/img/bg.260a05f.png"}},["NHnr"]);
//# sourceMappingURL=app.fda245fe4a999f4f7532.js.map